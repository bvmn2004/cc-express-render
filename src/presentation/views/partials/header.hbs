<nav class="relative flex items-center justify-between p-4 lg:px-6">
    <div class="block flex-none md:hidden"><!--$--><button aria-label="Open mobile menu"
            class="flex h-11 w-11 items-center justify-center rounded-md border border-neutral-200 text-black transition-colors md:hidden dark:border-neutral-700 dark:text-white"><svg
                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5">
                </path>
            </svg></button><!--/$--></div>
    <div class="flex w-full items-center">
        <div class="flex w-full md:w-1/3"><a class="mr-2 flex w-full items-center justify-center md:w-auto lg:mr-6"
                href="/">
                <div
                    class="flex flex-none items-center justify-center border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-black h-[40px] w-[40px] rounded-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" aria-label="Acme Store logo" viewBox="0 0 32 28"
                        class="h-4 w-4 fill-black dark:fill-white h-[16px] w-[16px]">
                        <path d="M21.5758 9.75769L16 0L0 28H11.6255L21.5758 9.75769Z"></path>
                        <path d="M26.2381 17.9167L20.7382 28H32L26.2381 17.9167Z"></path>
                    </svg>
                </div>
                <div class="ml-2 flex-none text-sm font-medium uppercase md:hidden lg:block">Luka Store</div>
            </a>
            <ul class="hidden gap-6 text-sm md:flex md:items-center">
                <li>
                    <a href="/search"
                        class="text-neutral-500 underline-offset-4 hover:text-black hover:underline dark:text-neutral-400 dark:hover:text-neutral-300">
                        All
                    </a>
                </li>
                {{#each navbarCategories}}
                <li>
                    <a href="/search/{{this.slug}}"
                        class="text-neutral-500 underline-offset-4 hover:text-black hover:underline dark:text-neutral-400 dark:hover:text-neutral-300">
                        {{this.name}}
                    </a>
                </li>
                {{/each}}
                <li>
                    <a href="/blogs"
                        class="text-neutral-500 underline-offset-4 hover:text-black hover:underline dark:text-neutral-400 dark:hover:text-neutral-300">
                        Blog
                    </a>
                </li>
            </ul>
        </div>
        <div class="hidden justify-center md:flex md:w-1/3"><!--$-->
            <form class="w-max-[550px] relative w-full lg:w-80 xl:w-full" action="/search"><input type="text"
                    placeholder="Search for products..." autocomplete="off"
                    class="text-md w-full rounded-lg border bg-white px-4 py-2 text-black placeholder:text-neutral-500 md:text-sm dark:border-neutral-800 dark:bg-transparent dark:text-white dark:placeholder:text-neutral-400"
                    name="q" value="">
                <div class="absolute right-0 top-0 mr-3 flex h-full items-center"><svg
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z">
                        </path>
                    </svg></div>
            </form><!--/$-->
        </div>
        <div class="flex justify-end md:w-1/3">
            <button aria-label="Open cart" id="open-cart" class="cursor-pointer">
                <div
                    class="relative flex h-11 w-11 items-center justify-center rounded-md border border-neutral-200 text-black transition-colors dark:border-neutral-700 dark:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" aria-hidden="true" data-slot="icon"
                        class="h-4 transition-all ease-in-out hover:scale-110">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z">
                        </path>
                    </svg>
                    {{#if cartCount}}
                    <div
                        class="absolute right-0 top-0 -mr-2 -mt-2 flex h-5 w-5 items-center justify-center rounded-full bg-blue-600 text-[11px] font-medium text-white">
                        {{cartCount}}</div>
                    {{/if}}
                </div>
            </button>
            <div id="cart-overlay" class="fixed inset-0 hidden bg-black/50 backdrop-blur-sm z-40">
            </div>

            <div id="cart-panel"
                class="fixed bottom-0 right-0 top-0 hidden h-full w-full flex-col border-l border-neutral-200 bg-white/80 p-6 text-black backdrop-blur-xl md:w-[390px] dark:border-neutral-700 dark:bg-black/80 dark:text-white z-100">
                <div class="flex items-center justify-between">
                    <p class="text-lg font-semibold">My Cart</p>
                    <button aria-label="Close cart" id="close-cart" class="cursor-pointer">
                        <div
                            class="relative flex h-11 w-11 items-center justify-center rounded-md border border-neutral-200 text-black transition-colors dark:border-neutral-700 dark:text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" aria-hidden="true" data-slot="icon"
                                class="h-6 transition-all ease-in-out hover:scale-110">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
                            </svg>
                        </div>
                    </button>
                </div>
                <div class="flex h-full flex-col! justify-between! overflow-hidden px-1 pb-10">
                    {{!-- <ul class="flex-grow overflow-auto py-4">
                        <li class="flex w-full flex-col border-b border-neutral-300 dark:border-neutral-700">
                            <div class="relative flex w-full flex-row justify-between px-1 py-4">
                                <div class="absolute z-40 -ml-1 -mt-2">
                                    <form
                                        action="javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')">
                                        <button type="submit" aria-label="Remove cart item"
                                            class="flex h-[24px] w-[24px] items-center justify-center rounded-full bg-neutral-500"><svg
                                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="1.5" stroke="currentColor" aria-hidden="true"
                                                data-slot="icon" class="mx-[1px] h-4 w-4 text-white dark:text-black">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M6 18 18 6M6 6l12 12">
                                                </path>
                                            </svg></button>
                                        <p aria-live="polite" class="sr-only" role="status"></p>
                                    </form>
                                </div>
                                <div class="flex flex-row">
                                    <div
                                        class="relative h-16 w-16 overflow-hidden rounded-md border border-neutral-300 bg-neutral-300 dark:border-neutral-700 dark:bg-neutral-900 dark:hover:bg-neutral-800">
                                        <img alt="Acme Drawstring Bag" loading="lazy" width="64" height="64"
                                            decoding="async" data-nimg="1" class="h-full w-full object-cover"
                                            srcset="/_next/image?url=https%3A%2F%2Fcdn.shopify.com%2Fs%2Ffiles%2F1%2F0754%2F3727%2F7491%2Ffiles%2Fbag-1-dark.png%3Fv%3D1689796304&amp;w=64&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.shopify.com%2Fs%2Ffiles%2F1%2F0754%2F3727%2F7491%2Ffiles%2Fbag-1-dark.png%3Fv%3D1689796304&amp;w=128&amp;q=75 2x"
                                            src="/_next/image?url=https%3A%2F%2Fcdn.shopify.com%2Fs%2Ffiles%2F1%2F0754%2F3727%2F7491%2Ffiles%2Fbag-1-dark.png%3Fv%3D1689796304&amp;w=128&amp;q=75"
                                            style="color: transparent;">
                                    </div><a class="z-30 ml-2 flex flex-row space-x-4"
                                        href="/product/acme-drawstring-bag?color=Black&amp;size=12+x+16+inch">
                                        <div class="flex flex-1 flex-col text-base"><span class="leading-tight">Acme
                                                Drawstring
                                                Bag</span>
                                            <p class="text-sm text-neutral-500 dark:text-neutral-400">Black / 12 x 16
                                                inch</p>
                                        </div>
                                    </a>
                                </div>
                                <div class="flex h-16 flex-col justify-between">
                                    <p class="flex justify-end space-y-2 text-right text-sm">12,00&nbsp;$<span
                                            class="ml-1 inline">USD</span></p>
                                    <div
                                        class="ml-auto flex h-9 flex-row items-center rounded-full border border-neutral-200 dark:border-neutral-700">
                                        <form
                                            action="javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')">
                                            <button type="submit" aria-label="Reduce item quantity"
                                                class="ease flex h-full min-w-[36px] max-w-[36px] flex-none items-center justify-center rounded-full p-2 transition-all duration-200 hover:border-neutral-800 hover:opacity-80 ml-auto"><svg
                                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                    stroke-width="1.5" stroke="currentColor" aria-hidden="true"
                                                    data-slot="icon" class="h-4 w-4 dark:text-neutral-500">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14">
                                                    </path>
                                                </svg></button>
                                            <p aria-live="polite" class="sr-only" role="status"></p>
                                        </form>
                                        <p class="w-6 text-center"><span class="w-full text-sm">1</span></p>
                                        <form
                                            action="javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')">
                                            <button type="submit" aria-label="Increase item quantity"
                                                class="ease flex h-full min-w-[36px] max-w-[36px] flex-none items-center justify-center rounded-full p-2 transition-all duration-200 hover:border-neutral-800 hover:opacity-80"><svg
                                                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                    stroke-width="1.5" stroke="currentColor" aria-hidden="true"
                                                    data-slot="icon" class="h-4 w-4 dark:text-neutral-500">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        d="M12 4.5v15m7.5-7.5h-15">
                                                    </path>
                                                </svg></button>
                                            <p aria-live="polite" class="sr-only" role="status"></p>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul> --}}
                    {{#if cart.length}}
                    <ul class="flex-grow overflow-auto py-4">
                        {{#each cart}}
                        <li class="flex w-full flex-col border-b border-neutral-300 dark:border-neutral-700">
                            <div class="relative flex w-full flex-row justify-between px-1 py-4">
                                <!-- Remove button -->
                                <form method="POST" action="/cart/remove/{{this.slug}}"
                                    class="absolute z-40 -ml-1 -mt-2">
                                    <button type="submit" aria-label="Remove {{this.name}}"
                                        class="flex h-[24px] w-[24px] items-center justify-center rounded-full bg-neutral-500 hover:bg-neutral-600 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor"
                                            class="mx-[1px] h-4 w-4 text-white">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M6 18 18 6M6 6l12 12" />
                                            </path>
                                        </svg>
                                    </button>
                                </form>

                                <!-- Image + info -->
                                <div class="flex flex-row flex-1 ml-8">
                                    <a href="/product/{{this.slug}}" class="flex-shrink-0">
                                        <img class="h-16 w-16 rounded-md border object-cover" src="{{this.image_url}}"
                                            alt="{{this.name}}">
                                    </a>
                                    <div class="ml-4 flex-1 min-w-0">
                                        <a href="/product/{{this.slug}}">
                                            <p class="font-semibold text-sm truncate">{{this.name}}</p>
                                        </a>
                                        <p class="text-sm text-neutral-500 dark:text-neutral-400">${{this.price}} Ã—
                                            {{this.qty}}</p>
                                        <p class="text-sm font-semibold mt-1">${{multiply this.price this.qty}}</p>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {{/each}}
                    </ul>
                    {{else}}
                    <div class="flex-grow flex items-center justify-center py-8">
                        <p class="text-neutral-500 dark:text-neutral-400">Your cart is empty</p>
                    </div>
                    {{/if}}
                    {{#if cart.length}}
                    <div>
                        <div class="py-4 text-sm text-neutral-500 dark:text-neutral-400">
                            <div
                                class="mb-3 flex items-center justify-between border-b border-neutral-200 pb-1 dark:border-neutral-700">
                                <p>Taxes</p>
                                <p class="text-right text-base text-black dark:text-white">$0.00<span
                                        class="ml-1 inline">USD</span></p>
                            </div>
                            <div
                                class="mb-3 flex items-center justify-between border-b border-neutral-200 pb-1 pt-1 dark:border-neutral-700">
                                <p>Shipping</p>
                                <p class="text-right text-base text-black dark:text-white">$0.00<span
                                        class="ml-1 inline">USD</span></p>
                            </div>
                            <div
                                class="mb-3 flex items-center justify-between border-b border-neutral-200 pb-1 pt-1 dark:border-neutral-700">
                                <p>Subtotal</p>
                                <p class="text-right text-base text-black dark:text-white">${{formatCurrency
                                    cartTotal}}<span class="ml-1 inline">USD</span></p>
                            </div>
                            <div class="mb-3 flex items-center justify-between pt-1">
                                <p class="font-semibold text-black dark:text-white">Total</p>
                                <p class="text-right text-base font-semibold text-black dark:text-white">
                                    ${{formatCurrency cartTotal}}<span class="ml-1 inline">USD</span></p>
                            </div>
                        </div>
                        <form action="/checkout/information" method="GET">
                            <button
                                class="block w-full rounded-full bg-blue-600 p-3 text-center text-sm font-medium text-white opacity-90 hover:opacity-100 cursor-pointer transition-opacity"
                                type="submit">Proceed to Checkout</button>
                        </form>
                    </div>
                    {{/if}}

                </div>
            </div>
        </div>
        <!-- User dropdown -->
        <div class="ml-4 relative">
            <button id="user-menu-button" aria-haspopup="true" aria-expanded="false"
                class="flex items-center focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 rounded-full border p-1" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M16 11c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 14c-4 0-7 2-7 4v1h14v-1c0-2-3-4-7-4z" />
                </svg>
            </button>
            <div id="user-menu"
                class="hidden absolute right-0 mt-2 w-40 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 z-50">
                <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button">
                    {{#if currentUser}}
                    <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        role="menuitem">Profile</a>
                    <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        role="menuitem">Logout</a>
                    {{else}}
                    <a href="/profile" class="block px-4 py-2 text-sm text-gray-400 cursor-not-allowed"
                        role="menuitem">Profile</a>
                    <a href="/login" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                        role="menuitem">Login</a>
                    {{/if}}
                </div>
            </div>
        </div>

        <script>
            (function () {
                const btn = document.getElementById('user-menu-button');
                const menu = document.getElementById('user-menu');
                if (!btn || !menu) return;
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const hidden = menu.classList.contains('hidden');
                    if (hidden) {
                        menu.classList.remove('hidden');
                    } else {
                        menu.classList.add('hidden');
                    }
                });
                // close when clicking outside
                document.addEventListener('click', () => {
                    if (!menu.classList.contains('hidden')) menu.classList.add('hidden');
                });
            })();
        </script>
    </div>
</nav>